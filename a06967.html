<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>jena-geo: GridFactory Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">jena-geo
   &#160;<span id="projectnumber">Version 0.1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a06967.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="a06964.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">GridFactory Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Creates image <a class="el" href="a06999.html">ResampleGrid</a> objects for the given <a class="el" href="">MathTransform2D</a>.  
 <a href="a06967.html#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for GridFactory:</div>
<div class="dyncontent">
<div class="center"><img src="a06965.png" border="0" usemap="#GridFactory_coll__map" alt="Collaboration graph"/></div>
<map name="GridFactory_coll__map" id="GridFactory_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae93c9f19be222c671a22fd518fdb8104"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#ae93c9f19be222c671a22fd518fdb8104">GridFactory</a> (final double <a class="el" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>)</td></tr>
<tr class="memdesc:ae93c9f19be222c671a22fd518fdb8104"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new factory.  <a href="#ae93c9f19be222c671a22fd518fdb8104">More...</a><br /></td></tr>
<tr class="separator:ae93c9f19be222c671a22fd518fdb8104"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77b14660e96073cea4cde53069901462"><td class="memItemLeft" align="right" valign="top">Object&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#a77b14660e96073cea4cde53069901462">create</a> (final MathTransform2D transform, final Rectangle domain)  throws TransformException     </td></tr>
<tr class="memdesc:a77b14660e96073cea4cde53069901462"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of the public <a class="el" href="">create(CharSequence name, MathTransform2D, Rectangle)</a> method, invoked only if the Warp object was not found in the cache.  <a href="#a77b14660e96073cea4cde53069901462">More...</a><br /></td></tr>
<tr class="separator:a77b14660e96073cea4cde53069901462"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:aa930ee057c3093ab10d90d7b3b46b238"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">roundIfAlmostInteger</a> (final double value)</td></tr>
<tr class="memdesc:aa930ee057c3093ab10d90d7b3b46b238"><td class="mdescLeft">&#160;</td><td class="mdescRight">Work around for rounding error.  <a href="#aa930ee057c3093ab10d90d7b3b46b238">More...</a><br /></td></tr>
<tr class="separator:aa930ee057c3093ab10d90d7b3b46b238"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e3dd81b255e008ab58971f96c5a559e"><td class="memItemLeft" align="right" valign="top">static Dimension&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a> (final MathTransform2D transform, final Point2D.Double point, final <a class="el" href="a06759.html">DoubleDimension2D</a> <a class="el" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>, final double xmin, final double xmax, final double ymin, final double ymax, final Matrix2 upperLeft, final Matrix2 upperRight, final Matrix2 lowerLeft, final Matrix2 lowerRight)  throws TransformException, ArithmeticException     </td></tr>
<tr class="memdesc:a8e3dd81b255e008ab58971f96c5a559e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the number of subdivisions (in power of 2) to apply in order to get a good.  <a href="#a8e3dd81b255e008ab58971f96c5a559e">More...</a><br /></td></tr>
<tr class="separator:a8e3dd81b255e008ab58971f96c5a559e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bf30057b76b18150cd1f32fa5622c1e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#a4bf30057b76b18150cd1f32fa5622c1e">incrementNonAffineDimension</a> (boolean he, boolean ve, Dimension <a class="el" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>)</td></tr>
<tr class="memdesc:a4bf30057b76b18150cd1f32fa5622c1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Increments the width, the height or both values in the given dimension, depending on which dimension are not affine.  <a href="#a4bf30057b76b18150cd1f32fa5622c1e">More...</a><br /></td></tr>
<tr class="separator:a4bf30057b76b18150cd1f32fa5622c1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acae78c23d8fdcf14f67e4436e1bcdac4"><td class="memItemLeft" align="right" valign="top">static Matrix2&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a> (final MathTransform2D transform, final Point2D point)  throws TransformException     </td></tr>
<tr class="memdesc:acae78c23d8fdcf14f67e4436e1bcdac4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the derivative of the given transform at the given location, and returns the result as a 2&times;2 matrix.  <a href="#acae78c23d8fdcf14f67e4436e1bcdac4">More...</a><br /></td></tr>
<tr class="separator:acae78c23d8fdcf14f67e4436e1bcdac4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a718cb25aee9fc34746c96ac8b1c3ad93"><td class="memItemLeft" align="right" valign="top">static boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a> (final Matrix2 center, final Matrix2 corner, final <a class="el" href="a06759.html">DoubleDimension2D</a> <a class="el" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>)</td></tr>
<tr class="memdesc:a718cb25aee9fc34746c96ac8b1c3ad93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns.  <a href="#a718cb25aee9fc34746c96ac8b1c3ad93">More...</a><br /></td></tr>
<tr class="separator:a718cb25aee9fc34746c96ac8b1c3ad93"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:abebf5e3f243bfaba46aca7475b7d23fe"><td class="memItemLeft" align="right" valign="top">final double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a></td></tr>
<tr class="memdesc:abebf5e3f243bfaba46aca7475b7d23fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximal error allowed, in units of destination CRS (usually pixels).  <a href="#abebf5e3f243bfaba46aca7475b7d23fe">More...</a><br /></td></tr>
<tr class="separator:abebf5e3f243bfaba46aca7475b7d23fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:af018e9005666344d223d59ad50ac8498"><td class="memItemLeft" align="right" valign="top">static final int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#af018e9005666344d223d59ad50ac8498">MIN_SIZE</a> = 4</td></tr>
<tr class="memdesc:af018e9005666344d223d59ad50ac8498"><td class="mdescLeft">&#160;</td><td class="mdescRight">The minimal size, in pixels.  <a href="#af018e9005666344d223d59ad50ac8498">More...</a><br /></td></tr>
<tr class="separator:af018e9005666344d223d59ad50ac8498"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa53cb17a306a6462b4a5a5083bc8ccb6"><td class="memItemLeft" align="right" valign="top">static final double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a06967.html#aa53cb17a306a6462b4a5a5083bc8ccb6">EPS</a> = 1.1920929E-7</td></tr>
<tr class="memdesc:aa53cb17a306a6462b4a5a5083bc8ccb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">A small tolerance factor for comparisons of floating point numbers.  <a href="#aa53cb17a306a6462b4a5a5083bc8ccb6">More...</a><br /></td></tr>
<tr class="separator:aa53cb17a306a6462b4a5a5083bc8ccb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Creates image <a class="el" href="a06999.html">ResampleGrid</a> objects for the given <a class="el" href="">MathTransform2D</a>. </p>
<p>The generated grid contain transformed coordinated from &lt;cite&gt;target&lt;/cite&gt; to &lt;cite&gt;source&lt;/cite&gt; CRS. (i.e. the image grid shall transform coordinates from target to source CRS). Consequently, consider invoking</p><div class="fragment"><div class="line">transform.inverse() </div></div><!-- fragment --><p> if the grid object is going to be used in an image reprojection.</p>
<p>{</p>
<h1><a class="anchor" id="Mapping"></a>
pixels corner or center}</h1>
<p>The semantic of &lt;cite&gt;Java Advanced Imaging&lt;/cite&gt;</p><div class="fragment"><div class="line">Resample </div></div><!-- fragment --><p> operation is to apply the transforms as below: </p>
<ul>
<li>
Offset all input coordinates by 0.5 in order to get the coordinates of pixel centers. </li>
<li>
Apply the transform. </li>
<li>
Offset all output coordinates by -0.5 in order to compensate for the input offset. </li>
</ul>
<p>This semantic implies that the  GridGeometry::getGridToCRS() grid to CRS} transforms were computed using <a class="el" href="">PixelOrientation#UPPER_LEFT</a>, as in Java2D usage.</p>
<dl class="section author"><dt>Author</dt><dd>Martin Desruisseaux (Geomatys). </dd>
<dd>
Remi Marechal (Geomatys). </dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ae93c9f19be222c671a22fd518fdb8104"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae93c9f19be222c671a22fd518fdb8104">&#9670;&nbsp;</a></span>GridFactory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a06967.html">GridFactory</a> </td>
          <td>(</td>
          <td class="paramtype">final double&#160;</td>
          <td class="paramname"><em>tolerance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a new factory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tolerance</td><td>The maximal error allowed, in units of destination CRS (usually pixels). This is the maximal difference allowed between a coordinate transformed using the original transform, and the same coordinate transformed using the warp created by this factory. </td></tr>
  </table>
  </dd>
</dl>

<p class="reference">References <a class="el" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">GridFactory.tolerance</a>.</p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                               {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        ensurePositive(<span class="stringliteral">&quot;tolerance&quot;</span>, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        this.<a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a> = <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    }</div><div class="ttc" id="a06967_html_abebf5e3f243bfaba46aca7475b7d23fe"><div class="ttname"><a href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">org.geotoolkit.image.interpolation.GridFactory.tolerance</a></div><div class="ttdeci">final double tolerance</div><div class="ttdoc">The maximal error allowed, in units of destination CRS (usually pixels). </div><div class="ttdef"><b>Definition:</b> GridFactory.java:73</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a77b14660e96073cea4cde53069901462"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77b14660e96073cea4cde53069901462">&#9670;&nbsp;</a></span>create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Object create </td>
          <td>(</td>
          <td class="paramtype">final MathTransform2D&#160;</td>
          <td class="paramname"><em>transform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final Rectangle&#160;</td>
          <td class="paramname"><em>domain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> throws TransformException</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implementation of the public <a class="el" href="">create(CharSequence name, MathTransform2D, Rectangle)</a> method, invoked only if the Warp object was not found in the cache. </p>

<p class="reference">References <a class="el" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">GridFactory.depth()</a>, <a class="el" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">GridFactory.derivative()</a>, <a class="el" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">GridFactory.roundIfAlmostInteger()</a>, <a class="el" href="a07699.html#ad4156f5f7098b2dc55d3434324e8e1fa">XAffineTransform.roundIfAlmostInteger()</a>, and <a class="el" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">GridFactory.tolerance</a>.</p>

<p class="reference">Referenced by <a class="el" href="a06991.html#ae3702ec1e03860b5e5488d6490274399">Resample.fillImage()</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> xmin = domain.getMinX();</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> xmax = domain.getMaxX();</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> ymin = domain.getMinY();</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> ymax = domain.getMaxY();</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keyword">final</span> Point2D.Double point = <span class="keyword">new</span> Point2D.Double(); <span class="comment">// Multi-purpose buffer.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keyword">final</span> Matrix2 upperLeft, upperRight, lowerLeft, lowerRight;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">try</span> {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            point.x = xmin; point.y = ymax; upperLeft  = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            point.x = xmax; point.y = ymax; upperRight = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            point.x = xmin; point.y = ymin; lowerLeft  = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            point.x = xmax; point.y = ymin; lowerRight = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        } <span class="keywordflow">catch</span> (TransformException e) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">             * Typically happen when the transform does not support the derivative function,</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">             * in which case we will fallback on the generic (but slow) adapter.</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            Logging.recoverableException(null, <a class="code" href="a06967.html#ae93c9f19be222c671a22fd518fdb8104">GridFactory</a>.class, <span class="stringliteral">&quot;create&quot;</span>, e);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> TransformException(<span class="stringliteral">&quot;grid creation : derivative function not supported by current Mathtransform&quot;</span>, e);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">         * The tolerance factor is scaled as below. The explanation below is for</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">         * a one-dimensional case, but the two dimensional case works on the same</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">         * principle.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">         * Let assume that we computed the derivative of y=f(x) at two locations: x₁ and x₃.</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">         * The derivative values (the slopes of the y=f(x) function) at those locations are</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">         * m₁ and m₃.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">         *          /          _/</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">         *         / x₁      _/ x₂      ─── x₃</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">         *        / m₁=1    /  m₂≈½        m₃=0</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">         * WarpGrid will interpolate the y values between x₁ and x₃. The interpolated results</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">         * should be exact at locations x₁ and x₃ and have some errors between those two end</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">         * points.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">         * HYPOTHESIS:</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">         *  1) We presume that the greatest error will be located mid-way between x₁ and x₃.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">         *     The x₂ point above represents that location.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">         *  2) We presume that the derivative between x₁ and x₃ varies continuously from m₁ to m₃.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">         *     The derivative at x₂ may be something close to m₂ ≈ (m₁ + m₃) / 2, but we don&#39;t</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">         *     actually known.</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">         * Let compute linear approximations of y=f(x) using the two slopes m₁ and m₃. If</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">         * the hypothesis #2 is true, then the real y values are somewhere between the two</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">         * approximations. The formulas below use the x₁ point, but we would get the same</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">         * final equation if we used the x₃ instead (we don&#39;t use both x₁ and x₃ since</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">         * solving such equation produce 0=0).</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">         * Given f₁(x) = y₁ + (x - x₁)*m₁</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">         *   and f₃(x) = y₁ + (x - x₁)*m₃</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">         * then the error ε = f₃(x) - f₁(x) at location x=x₂ is (x₂-x₁) * (m₃-m₁).</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">         * Given x₂ = (x₁+x₃)/2, we get ε = (x₃-x₁)/2 * (m₃-m₁).</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">         * If we rearange the terms, we get:  (m₃-m₁) = 2*ε / (x₃-x₁).</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">         * The (m₃ - m₁) value is the maximal difference to be accepted</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">         * in the coefficients of the derivative matrix to be compared.</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keyword">final</span> Dimension <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">try</span> {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="keyword">final</span> <span class="keywordtype">double</span> tol = 2 * <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            depth = <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>(transform, point,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    <span class="keyword">new</span> DoubleDimension2D(tol / (xmax - xmin), tol / (ymax - ymin)),</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    xmin, xmax, ymin, ymax, upperLeft, upperRight, lowerLeft, lowerRight);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        } <span class="keywordflow">catch</span> (ArithmeticException e) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">             * The method does not converge.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            Logging.recoverableException(null, <a class="code" href="a06967.html#ae93c9f19be222c671a22fd518fdb8104">GridFactory</a>.class, <span class="stringliteral">&quot;create&quot;</span>, e);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> ArithmeticException(<span class="stringliteral">&quot;grid creation : current mathtransform does not converge.&quot;</span>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">if</span> (depth.width == 0 &amp;&amp; depth.height == 0) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">             * The transform is approximatively affine. Compute the matrix coefficients using</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">             * the points projected on the four borders of the domain, in order to get a kind</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">             * of average coefficient values. We don&#39;t use the derivative matrix in the center</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">             * location, because it may not be the best &quot;average&quot; value and some map projection</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">             * implementations use approximation derived from spherical formulas. The difference</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">             * is big enough for causing test failure.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keyword">final</span> <span class="keywordtype">double</span> xcnt = domain.getCenterX();</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <span class="keyword">final</span> <span class="keywordtype">double</span> ycnt = domain.getCenterY();</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordtype">double</span> m00, m10, m01, m11;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            Point2D p;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="comment">// TODO: we must check for the cases where xmin &gt; xmax after transformation,</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="comment">//       and handle that as an Envelope the cross the anti-meridian.</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            point.x=xmax; point.y=ycnt; p=transform.transform(point, point); m00  = p.getX(); m10  = p.getY();</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            point.x=xmin; point.y=ycnt; p=transform.transform(point, point); m00 -= p.getX(); m10 -= p.getY();</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            point.x=xcnt; point.y=ymax; p=transform.transform(point, point); m01  = p.getX(); m11  = p.getY();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            point.x=xcnt; point.y=ymin; p=transform.transform(point, point); m01 -= p.getX(); m11 -= p.getY();</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            point.x=xcnt; point.y=ycnt; p=transform.transform(point, point);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keyword">final</span> <span class="keywordtype">double</span> width  = domain.getWidth();</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keyword">final</span> <span class="keywordtype">double</span> height = domain.getHeight();</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keyword">final</span> AffineTransform tr = <span class="keyword">new</span> AffineTransform(</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                    <a class="code" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">roundIfAlmostInteger</a>(m00 / width),  <a class="code" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">roundIfAlmostInteger</a>(m10 / width),</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    <a class="code" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">roundIfAlmostInteger</a>(m01 / height), <a class="code" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">roundIfAlmostInteger</a>(m11 / height),</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                    <a class="code" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">roundIfAlmostInteger</a>(p.getX()),     <a class="code" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">roundIfAlmostInteger</a>(p.getY()));</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">             * Note: we rounded the scale and shear factors because they will impact</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">             * the translation computation below (we may get a number like 1E-13 when</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">             * the expected value is zero).</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            tr.translate(-xcnt, -ycnt);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            XAffineTransform.roundIfAlmostInteger(tr, <a class="code" href="a06967.html#aa53cb17a306a6462b4a5a5083bc8ccb6">EPS</a>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">return</span> tr;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">         * Non-affine transform. Create a grid using the cell size computed (indirectly)</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">         * by the &#39;depth&#39; method.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">int</span> xStep     =  domain.width  / (1 &lt;&lt; depth.width);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">int</span> yStep     =  domain.height / (1 &lt;&lt; depth.height);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">         * Grid width equals xNumCells + 1.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">         * xNumCells is the number of sub-division on x axis.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">int</span> xNumCells = (domain.width  + xStep-1) / xStep;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">         * Grid height equals yNumCells + 1.</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">         * xNumCells is the number of sub-division on y axis.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">int</span> yNumCells = (domain.height + yStep-1) / yStep;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span>[] warpPositions = <span class="keyword">new</span> <span class="keywordtype">double</span>[((xNumCells+1) * (yNumCells+1)) &lt;&lt; 1];</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">int</span> xup = domain.x + xNumCells * xStep;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">int</span> yup = domain.y + yNumCells * yStep;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordtype">int</span> p = 0;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=domain.y; y &lt;= yup; y += yStep) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=domain.x; x &lt;= xup; x += xStep) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                warpPositions[p++] = x;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                warpPositions[p++] = y;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">         * Note: The 0.5 offset is handled by precedently mathtransform concatenation</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">         * effectuate by user at resample implementation, so we don&#39;t need to apply it ourself in &#39;gridPositions&#39;.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        transform.transform(warpPositions, 0, warpPositions, 0, p/2);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> ResampleGrid(domain.x,domain.y, xStep, yStep, xNumCells + 1, yNumCells + 1, warpPositions);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div><div class="ttc" id="a06967_html_aa930ee057c3093ab10d90d7b3b46b238"><div class="ttname"><a href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">org.geotoolkit.image.interpolation.GridFactory.roundIfAlmostInteger</a></div><div class="ttdeci">static double roundIfAlmostInteger(final double value)</div><div class="ttdoc">Work around for rounding error. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:93</div></div>
<div class="ttc" id="a06967_html_aa53cb17a306a6462b4a5a5083bc8ccb6"><div class="ttname"><a href="a06967.html#aa53cb17a306a6462b4a5a5083bc8ccb6">org.geotoolkit.image.interpolation.GridFactory.EPS</a></div><div class="ttdeci">static final double EPS</div><div class="ttdoc">A small tolerance factor for comparisons of floating point numbers. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:66</div></div>
<div class="ttc" id="a06967_html_acae78c23d8fdcf14f67e4436e1bcdac4"><div class="ttname"><a href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">org.geotoolkit.image.interpolation.GridFactory.derivative</a></div><div class="ttdeci">static Matrix2 derivative(final MathTransform2D transform, final Point2D point)</div><div class="ttdoc">Computes the derivative of the given transform at the given location, and returns the result as a 2×2...</div><div class="ttdef"><b>Definition:</b> GridFactory.java:420</div></div>
<div class="ttc" id="a06967_html_abebf5e3f243bfaba46aca7475b7d23fe"><div class="ttname"><a href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">org.geotoolkit.image.interpolation.GridFactory.tolerance</a></div><div class="ttdeci">final double tolerance</div><div class="ttdoc">The maximal error allowed, in units of destination CRS (usually pixels). </div><div class="ttdef"><b>Definition:</b> GridFactory.java:73</div></div>
<div class="ttc" id="a06967_html_ae93c9f19be222c671a22fd518fdb8104"><div class="ttname"><a href="a06967.html#ae93c9f19be222c671a22fd518fdb8104">org.geotoolkit.image.interpolation.GridFactory.GridFactory</a></div><div class="ttdeci">GridFactory(final double tolerance)</div><div class="ttdoc">Creates a new factory. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:83</div></div>
<div class="ttc" id="a06967_html_a8e3dd81b255e008ab58971f96c5a559e"><div class="ttname"><a href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">org.geotoolkit.image.interpolation.GridFactory.depth</a></div><div class="ttdeci">static Dimension depth(final MathTransform2D transform, final Point2D.Double point, final DoubleDimension2D tolerance, final double xmin, final double xmax, final double ymin, final double ymax, final Matrix2 upperLeft, final Matrix2 upperRight, final Matrix2 lowerLeft, final Matrix2 lowerRight)</div><div class="ttdoc">Computes the number of subdivisions (in power of 2) to apply in order to get a good. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:281</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e3dd81b255e008ab58971f96c5a559e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e3dd81b255e008ab58971f96c5a559e">&#9670;&nbsp;</a></span>depth()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Dimension depth </td>
          <td>(</td>
          <td class="paramtype">final MathTransform2D&#160;</td>
          <td class="paramname"><em>transform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final Point2D.Double&#160;</td>
          <td class="paramname"><em>point</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final <a class="el" href="a06759.html">DoubleDimension2D</a>&#160;</td>
          <td class="paramname"><em>tolerance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final double&#160;</td>
          <td class="paramname"><em>xmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final double&#160;</td>
          <td class="paramname"><em>xmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final double&#160;</td>
          <td class="paramname"><em>ymin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final double&#160;</td>
          <td class="paramname"><em>ymax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final Matrix2&#160;</td>
          <td class="paramname"><em>upperLeft</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final Matrix2&#160;</td>
          <td class="paramname"><em>upperRight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final Matrix2&#160;</td>
          <td class="paramname"><em>lowerLeft</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final Matrix2&#160;</td>
          <td class="paramname"><em>lowerRight</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> throws TransformException, ArithmeticException</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Computes the number of subdivisions (in power of 2) to apply in order to get a good. </p>
<div class="fragment"><div class="line">WarpGrid </div></div><!-- fragment --><p> approximation. The</p><div class="fragment"><div class="line">width </div></div><!-- fragment --><p>  and</p><div class="fragment"><div class="line">height </div></div><!-- fragment --><p> fields in the returned value have the following meaning: </p>
<ul>
<li>
0 means that the transform is approximatively affine in the region of interest. </li>
<li>
1 means that we should split the grid in two parts horizontally and/or vertically. </li>
<li>
2 means that we should split the grid in four parts horizontally and/or vertically. </li>
<li>
etc. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">transform</td><td>The transform for which to compute the depth. </td></tr>
    <tr><td class="paramname">point</td><td>Any<div class="fragment"><div class="line">Point2D.Double </div></div><!-- fragment --> instance, to be overwritten by this method. This is provided in argument only to reduce the amount of object allocations. </td></tr>
    <tr><td class="paramname">tolerance</td><td>The tolerance value to use in comparisons of matrix coefficients, along the X axis and along the Y axis. The distance between the location of the matrix being compared is half the size of the region of interest. </td></tr>
    <tr><td class="paramname">xmin</td><td>The minimal <em>x</em> ordinate. </td></tr>
    <tr><td class="paramname">xmax</td><td>The maximal <em>x</em> ordinate. </td></tr>
    <tr><td class="paramname">ymin</td><td>The minimal <em>y</em> ordinate. </td></tr>
    <tr><td class="paramname">ymax</td><td>The maximal <em>y</em> ordinate. </td></tr>
    <tr><td class="paramname">upperLeft</td><td>The transform derivative at<div class="fragment"><div class="line">(xmin,ymax) </div></div><!-- fragment --> . </td></tr>
    <tr><td class="paramname">upperRight</td><td>The transform derivative at<div class="fragment"><div class="line">(xmax,ymax) </div></div><!-- fragment --> . </td></tr>
    <tr><td class="paramname">lowerLeft</td><td>The transform derivative at<div class="fragment"><div class="line">(xmin,ymin) </div></div><!-- fragment --> . </td></tr>
    <tr><td class="paramname">lowerRight</td><td>The transform derivative at<div class="fragment"><div class="line">(xmax,ymin) </div></div><!-- fragment --> . </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of subdivision along each axes. </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">TransformException</td><td>If a derivative can not be computed. </td></tr>
    <tr><td class="paramname">ArithmeticException</td><td>If this method does not converge. </td></tr>
  </table>
  </dd>
</dl>

<p class="reference">References <a class="el" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">GridFactory.derivative()</a>, <a class="el" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">GridFactory.equals()</a>, <a class="el" href="a07863.html#a6a28bf4ed15b946061619d84a67eefdc">Errors.format()</a>, <a class="el" href="a06967.html#a4bf30057b76b18150cd1f32fa5622c1e">GridFactory.incrementNonAffineDimension()</a>, and <a class="el" href="a07867.html#a2837bd62d95d53aa3e42ec1695cac72a">Errors.Keys.NoConvergence</a>.</p>

<p class="reference">Referenced by <a class="el" href="a06967.html#a77b14660e96073cea4cde53069901462">GridFactory.create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">if</span> (!(xmax - xmin &gt;= <a class="code" href="a06967.html#af018e9005666344d223d59ad50ac8498">MIN_SIZE</a>) || !(ymax - ymin &gt;= <a class="code" href="a06967.html#af018e9005666344d223d59ad50ac8498">MIN_SIZE</a>)) { <span class="comment">// Use ! for catching NaN.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">throw</span> <span class="keyword">new</span> ArithmeticException(Errors.format(Errors.Keys.NoConvergence));</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">         * All derivatives will be compared to the derivative at (centerX, centerY).</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">         * Consequently, the distance between the derivatives are half the distance</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">         * between [x|y]min and [x|y]max (approximatively - we ignore the diagonal).</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">         * Consequently, the tolerance threshold can be augmented by the same factor.</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> oldTolX = <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.width;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> oldTolY = <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.height;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.width  *= 2;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.height *= 2;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> centerX = point.x = 0.5 * (xmin + xmax);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> centerY = point.y = 0.5 * (ymin + ymax);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keyword">final</span> Matrix2 center = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        point.x = xmin;    point.y = centerY; <span class="keyword">final</span> Matrix2 centerLeft  = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        point.x = xmax;    point.y = centerY; <span class="keyword">final</span> Matrix2 centerRight = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        point.x = centerX; point.y = ymin;    <span class="keyword">final</span> Matrix2 centerLower = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        point.x = centerX; point.y = ymax;    <span class="keyword">final</span> Matrix2 centerUpper = <a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(transform, point);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">boolean</span> cl = <a class="code" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a>(center, centerLeft,  <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">boolean</span> cr = <a class="code" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a>(center, centerRight, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">boolean</span> cb = <a class="code" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a>(center, centerLower, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">boolean</span> cu = <a class="code" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a>(center, centerUpper, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordtype">int</span> nx=0, ny=0;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">         *   upperLeft  ┌──────┬─ centerUpper</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">         *              │      │</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">         *   centerLeft ├──────┼─ center</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">if</span> (!cl || !cu || !<a class="code" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a>(center, upperLeft, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>)) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keyword">final</span> Dimension <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a> = <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>(transform, point, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>,</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                    xmin, centerX, centerY, ymax,</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                    upperLeft, centerUpper, centerLeft, center);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <a class="code" href="a06967.html#a4bf30057b76b18150cd1f32fa5622c1e">incrementNonAffineDimension</a>(cl, cu, depth);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            nx = depth.width;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            ny = depth.height;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">         *   centerUpper ─┬──────┐ upperRight</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">         *                │      │</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">         *   center      ─┼──────┤ centerRight</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">if</span> (!cr || !cu || !<a class="code" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a>(center, upperRight, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>)) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            <span class="keyword">final</span> Dimension <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a> = <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>(transform, point, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>,</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                    centerX, xmax, centerY, ymax,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    centerUpper, upperRight, center, centerRight);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <a class="code" href="a06967.html#a4bf30057b76b18150cd1f32fa5622c1e">incrementNonAffineDimension</a>(cr, cu, depth);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            nx = Math.max(nx, depth.width);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            ny = Math.max(ny, depth.height);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">         *   centerLeft ├──────┼─ center</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">         *              │      │</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">         *   lowerLeft  └──────┴─ centerLower</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span> (!cl || !cb || !<a class="code" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a>(center, lowerLeft, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>)) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keyword">final</span> Dimension depth = <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>(transform, point, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                    xmin, centerX, ymin, centerY,</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                    centerLeft, center, lowerLeft, centerLower);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <a class="code" href="a06967.html#a4bf30057b76b18150cd1f32fa5622c1e">incrementNonAffineDimension</a>(cl, cb, depth);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            nx = Math.max(nx, depth.width);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            ny = Math.max(ny, depth.height);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">         *   center      ─┼──────┤ centerRight</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">         *                │      │</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">         *   centerLower ─┴──────┘ lowerRight</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">if</span> (!cr || !cb || !<a class="code" href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">equals</a>(center, lowerRight, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>)) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keyword">final</span> Dimension depth = <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>(transform, point, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>,</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    centerX, xmax, ymin, centerY,</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                    center, centerRight, centerLower, lowerRight);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <a class="code" href="a06967.html#a4bf30057b76b18150cd1f32fa5622c1e">incrementNonAffineDimension</a>(cr, cb, depth);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            nx = Math.max(nx, depth.width);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            ny = Math.max(ny, depth.height);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.width  = oldTolX;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.height = oldTolY;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> Dimension(nx, ny);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div><div class="ttc" id="a06967_html_a4bf30057b76b18150cd1f32fa5622c1e"><div class="ttname"><a href="a06967.html#a4bf30057b76b18150cd1f32fa5622c1e">org.geotoolkit.image.interpolation.GridFactory.incrementNonAffineDimension</a></div><div class="ttdeci">static void incrementNonAffineDimension(boolean he, boolean ve, Dimension depth)</div><div class="ttdoc">Increments the width, the height or both values in the given dimension, depending on which dimension ...</div><div class="ttdef"><b>Definition:</b> GridFactory.java:389</div></div>
<div class="ttc" id="a06967_html_acae78c23d8fdcf14f67e4436e1bcdac4"><div class="ttname"><a href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">org.geotoolkit.image.interpolation.GridFactory.derivative</a></div><div class="ttdeci">static Matrix2 derivative(final MathTransform2D transform, final Point2D point)</div><div class="ttdoc">Computes the derivative of the given transform at the given location, and returns the result as a 2×2...</div><div class="ttdef"><b>Definition:</b> GridFactory.java:420</div></div>
<div class="ttc" id="a06967_html_af018e9005666344d223d59ad50ac8498"><div class="ttname"><a href="a06967.html#af018e9005666344d223d59ad50ac8498">org.geotoolkit.image.interpolation.GridFactory.MIN_SIZE</a></div><div class="ttdeci">static final int MIN_SIZE</div><div class="ttdoc">The minimal size, in pixels. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:50</div></div>
<div class="ttc" id="a06967_html_abebf5e3f243bfaba46aca7475b7d23fe"><div class="ttname"><a href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">org.geotoolkit.image.interpolation.GridFactory.tolerance</a></div><div class="ttdeci">final double tolerance</div><div class="ttdoc">The maximal error allowed, in units of destination CRS (usually pixels). </div><div class="ttdef"><b>Definition:</b> GridFactory.java:73</div></div>
<div class="ttc" id="a06967_html_a8e3dd81b255e008ab58971f96c5a559e"><div class="ttname"><a href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">org.geotoolkit.image.interpolation.GridFactory.depth</a></div><div class="ttdeci">static Dimension depth(final MathTransform2D transform, final Point2D.Double point, final DoubleDimension2D tolerance, final double xmin, final double xmax, final double ymin, final double ymax, final Matrix2 upperLeft, final Matrix2 upperRight, final Matrix2 lowerLeft, final Matrix2 lowerRight)</div><div class="ttdoc">Computes the number of subdivisions (in power of 2) to apply in order to get a good. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:281</div></div>
<div class="ttc" id="a06967_html_a718cb25aee9fc34746c96ac8b1c3ad93"><div class="ttname"><a href="a06967.html#a718cb25aee9fc34746c96ac8b1c3ad93">org.geotoolkit.image.interpolation.GridFactory.equals</a></div><div class="ttdeci">static boolean equals(final Matrix2 center, final Matrix2 corner, final DoubleDimension2D tolerance)</div><div class="ttdoc">Returns. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:434</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acae78c23d8fdcf14f67e4436e1bcdac4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acae78c23d8fdcf14f67e4436e1bcdac4">&#9670;&nbsp;</a></span>derivative()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static Matrix2 derivative </td>
          <td>(</td>
          <td class="paramtype">final MathTransform2D&#160;</td>
          <td class="paramname"><em>transform</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final Point2D&#160;</td>
          <td class="paramname"><em>point</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> throws TransformException</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Computes the derivative of the given transform at the given location, and returns the result as a 2&times;2 matrix. </p>
<p>This method invokes the <a class="el" href="">MathTransform2D#derivative(Point2D)</a> and convert or cast the result to a <a class="el" href="">Matrix2</a> instance. </p>
<p>In the Geotk implementation, the matrix returned by the</p><div class="fragment"><div class="line"><a class="code" href="a06967.html#acae78c23d8fdcf14f67e4436e1bcdac4">derivative</a>(Point2D) </div></div><!-- fragment --><p> methods are already instances of <a class="el" href="">Matrix2</a>. Consequently in most cases this method will just cast the result.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">transform</td><td>The transform for which to compute the derivative. </td></tr>
    <tr><td class="paramname">point</td><td>The location where to compute the derivative. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The derivative at the given location as a 2&times;2 matrix. </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">TransformException</td><td>If the derivative can not be computed. </td></tr>
  </table>
  </dd>
</dl>

<p class="reference">Referenced by <a class="el" href="a06967.html#a77b14660e96073cea4cde53069901462">GridFactory.create()</a>, and <a class="el" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">GridFactory.depth()</a>.</p>
<div class="fragment"><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keyword">final</span> Matrix matrix = transform.derivative(point);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">return</span> (matrix instanceof Matrix2) ? (Matrix2) matrix : <span class="keyword">new</span> Matrix2(</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                matrix.getElement(0,0), matrix.getElement(0,1),</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                matrix.getElement(1,0), matrix.getElement(1,1));</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a id="a718cb25aee9fc34746c96ac8b1c3ad93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a718cb25aee9fc34746c96ac8b1c3ad93">&#9670;&nbsp;</a></span>equals()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static boolean equals </td>
          <td>(</td>
          <td class="paramtype">final Matrix2&#160;</td>
          <td class="paramname"><em>center</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final Matrix2&#160;</td>
          <td class="paramname"><em>corner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">final <a class="el" href="a06759.html">DoubleDimension2D</a>&#160;</td>
          <td class="paramname"><em>tolerance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns. </p>
<div class="fragment"><div class="line"><span class="keyword">true</span> </div></div><!-- fragment --><p> if the given matrix are equals, up to the given tolerance threshold. The threshold can be different for the X and Y axis. This allows the condition to break the loop sooner (resulting in smaller grids) inside the</p><div class="fragment"><div class="line"><a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a> </div></div><!-- fragment --><p> method. </p>

<p class="reference">References <a class="el" href="a06759.html#a89f6abd564014faeff7cd20c340a9c7d">DoubleDimension2D.height</a>, and <a class="el" href="a06759.html#a9df23e056f5d1a0388cd8190431c0e03">DoubleDimension2D.width</a>.</p>

<p class="reference">Referenced by <a class="el" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">GridFactory.depth()</a>.</p>
<div class="fragment"><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                                                                                                                 {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">return</span> Math.abs(center.m00 - corner.m00) &lt;= <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.width  &amp;&amp;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;               Math.abs(center.m01 - corner.m01) &lt;= <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.width  &amp;&amp;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;               Math.abs(center.m10 - corner.m10) &lt;= <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.height &amp;&amp;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;               Math.abs(center.m11 - corner.m11) &lt;= <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>.height;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div><div class="ttc" id="a06967_html_abebf5e3f243bfaba46aca7475b7d23fe"><div class="ttname"><a href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">org.geotoolkit.image.interpolation.GridFactory.tolerance</a></div><div class="ttdeci">final double tolerance</div><div class="ttdoc">The maximal error allowed, in units of destination CRS (usually pixels). </div><div class="ttdef"><b>Definition:</b> GridFactory.java:73</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4bf30057b76b18150cd1f32fa5622c1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bf30057b76b18150cd1f32fa5622c1e">&#9670;&nbsp;</a></span>incrementNonAffineDimension()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void incrementNonAffineDimension </td>
          <td>(</td>
          <td class="paramtype">boolean&#160;</td>
          <td class="paramname"><em>he</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boolean&#160;</td>
          <td class="paramname"><em>ve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Dimension&#160;</td>
          <td class="paramname"><em>depth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Increments the width, the height or both values in the given dimension, depending on which dimension are not affine. </p>
<p>This method <b>most</b> be invoked using the following pattern, where</p><div class="fragment"><div class="line">center </div></div><!-- fragment --><p> is the matrix of the transform derivative in the center of the region of interest. Note: the order of operations in the</p><div class="fragment"><div class="line"><span class="keywordflow">if</span> </div></div><!-- fragment --><p> statement matter!</p>
<div class="fragment"><div class="line">java</div><div class="line">   he = center.equals(matrixOnTheSameHorizontalLine,  <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>);</div><div class="line">   ve = center.equals(matrixOnTheSameVerticalLine,    <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>);</div><div class="line">   <span class="keywordflow">if</span> (!he || !ve || center.equals(matrixOnADiagonal, <a class="code" href="a06967.html#abebf5e3f243bfaba46aca7475b7d23fe">tolerance</a>)) {</div><div class="line">       <a class="code" href="a06967.html#a4bf30057b76b18150cd1f32fa5622c1e">incrementNonAffineDimension</a>(he, ve, <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>);</div><div class="line">   }</div></div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">he</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="reference">Referenced by <a class="el" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">GridFactory.depth()</a>.</p>
<div class="fragment"><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                                                                             {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">if</span> (he == ve) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="comment">// Both dimensions are not affine: either (he, ve)==false (the obvious case),</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="comment">// or (he,ve) == true in which case this method have been invoked only if the</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="comment">// last center.equals(...) test in the &#39;if&#39; statement returned false.</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>.width++;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>.height++;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ve) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="comment">// Implies (he == false): horizontal dimension is not affine.</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="comment">// Don&#39;t touch to the vertical dimension since it is affine.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>.width++;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="comment">// Implies (he == true): horizontal dimension is affine, don&#39;t touch it.</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <a class="code" href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">depth</a>.height++;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div><div class="ttc" id="a06967_html_a8e3dd81b255e008ab58971f96c5a559e"><div class="ttname"><a href="a06967.html#a8e3dd81b255e008ab58971f96c5a559e">org.geotoolkit.image.interpolation.GridFactory.depth</a></div><div class="ttdeci">static Dimension depth(final MathTransform2D transform, final Point2D.Double point, final DoubleDimension2D tolerance, final double xmin, final double xmax, final double ymin, final double ymax, final Matrix2 upperLeft, final Matrix2 upperRight, final Matrix2 lowerLeft, final Matrix2 lowerRight)</div><div class="ttdoc">Computes the number of subdivisions (in power of 2) to apply in order to get a good. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:281</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa930ee057c3093ab10d90d7b3b46b238"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa930ee057c3093ab10d90d7b3b46b238">&#9670;&nbsp;</a></span>roundIfAlmostInteger()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double roundIfAlmostInteger </td>
          <td>(</td>
          <td class="paramtype">final double&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Work around for rounding error. </p>
<p>The tolerance threshold is arbitrary. This method is mostly for catching the cases were we expected an identity transform from the source grid to the target grid (for example the <em>x</em> axis in a Mercator projection). </p>

<p class="reference">References <a class="el" href="a06967.html#aa53cb17a306a6462b4a5a5083bc8ccb6">GridFactory.EPS</a>.</p>

<p class="reference">Referenced by <a class="el" href="a06967.html#a77b14660e96073cea4cde53069901462">GridFactory.create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                                                                   {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keyword">final</span> <span class="keywordtype">double</span> rounded = Math.round(value);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> (rounded != 0 &amp;&amp; Math.abs(rounded - value) &lt;= <a class="code" href="a06967.html#aa53cb17a306a6462b4a5a5083bc8ccb6">EPS</a>) {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="keywordflow">return</span> rounded;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">return</span> value;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div><div class="ttc" id="a06967_html_aa53cb17a306a6462b4a5a5083bc8ccb6"><div class="ttname"><a href="a06967.html#aa53cb17a306a6462b4a5a5083bc8ccb6">org.geotoolkit.image.interpolation.GridFactory.EPS</a></div><div class="ttdeci">static final double EPS</div><div class="ttdoc">A small tolerance factor for comparisons of floating point numbers. </div><div class="ttdef"><b>Definition:</b> GridFactory.java:66</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="aa53cb17a306a6462b4a5a5083bc8ccb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa53cb17a306a6462b4a5a5083bc8ccb6">&#9670;&nbsp;</a></span>EPS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">final double EPS = 1.1920929E-7</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A small tolerance factor for comparisons of floating point numbers. </p>
<p>We use the smallest accuracy possible for the</p><div class="fragment"><div class="line"><span class="keywordtype">float</span> </div></div><!-- fragment --><p> type for integer numbers different than zero, as computed by:</p>
<p>{ java Math.nextUp(1f) - 1f; }</p>
<p>Since <a class="el" href="">WarpAffine</a> will convert the</p><div class="fragment"><div class="line"><span class="keywordtype">double</span> </div></div><!-- fragment --><p> coefficients to</p><div class="fragment"><div class="line"><span class="keywordtype">float</span> </div></div><!-- fragment --><p> , a tolerance factor not greater than this value should avoid the lost of information. We still use it in order to fix the coefficients that are close to zero, especially shear factors. (e.g. 1E-13 for a shear factor that was expected to be zero). </p>

<p class="reference">Referenced by <a class="el" href="a06967.html#aa930ee057c3093ab10d90d7b3b46b238">GridFactory.roundIfAlmostInteger()</a>.</p>

</div>
</div>
<a id="af018e9005666344d223d59ad50ac8498"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af018e9005666344d223d59ad50ac8498">&#9670;&nbsp;</a></span>MIN_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">final int MIN_SIZE = 4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The minimal size, in pixels. </p>
<p>If the cell size is lower than this threshold, we will abandon the attempt to create a <a class="el" href="a06999.html">ResampleGrid</a>. </p>

</div>
</div>
<a id="abebf5e3f243bfaba46aca7475b7d23fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abebf5e3f243bfaba46aca7475b7d23fe">&#9670;&nbsp;</a></span>tolerance</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">final double tolerance</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The maximal error allowed, in units of destination CRS (usually pixels). </p>
<p>This is the maximal difference allowed between a coordinate transformed using the original transform, and the same coordinate transformed using the warp. </p>

<p class="reference">Referenced by <a class="el" href="a06967.html#a77b14660e96073cea4cde53069901462">GridFactory.create()</a>, and <a class="el" href="a06967.html#ae93c9f19be222c671a22fd518fdb8104">GridFactory.GridFactory()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a03857.html">org</a></li><li class="navelem"><a class="el" href="a03866.html">geotoolkit</a></li><li class="navelem"><a class="el" href="a03874.html">image</a></li><li class="navelem"><a class="el" href="a03878.html">interpolation</a></li><li class="navelem"><a class="el" href="a06967.html">GridFactory</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
