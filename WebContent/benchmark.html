<html>
<title>GeoSPARQL 2.0 Benchmark</title>
<script src="js/postgis_result.js"></script>
<script src="js/utils.js"></script>
   <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css"/>
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
   integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
   crossorigin=""></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.1/js/jquery.tablesorter.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script> 
   
<script>
var reslabels=[];

var geosparql20results=[]; 

var postgisresults=[]; 

var webserviceresult;

function loadAllBenchmarks(){
geosparql20results=[];
reslabels=[];
var url=document.location.href
url=url.replace("benchmark.html","")
if(!url.endsWith("/")){
	url+="/"
}
for(ps in postgis){
	//postgisresults.push(postgis[ps]["result"])
}
var table="<thead><tr><th>Benchmark</th><th>Dataset</th><th>POSTGIS</th><th>GeoSPARQL2.0</td><th>Resultset Size</th></tr></thead><tbody>"
    for(obj in postgis){
    	//reslabels.push(postgis[obj]["experiment"]);
    	postgisresults.push(postgis[obj]["experiment"]);
    	table+="<tr><td>"+postgis[obj]["experiment"]+"</td><td>"+("dataset" in postgis[obj]?postgis[obj]["dataset"]:"")+"</td><td>"+postgis[obj]["result"]+"</td><td></td></tr>"
    }
$('#queryres').html(table+"</tbody>")
$("#queryres").tablesorter();
console.log(postgisresults)
console.log(url)
$.get(url+"rest/service/benchmark?query="+encodeURIComponent($('#benchmarktest').val())+"&dataset="+encodeURIComponent($('#dataset').val()), function(data, status){
    webserviceresult=JSON.parse(data)
	paintResults();
});

}

function paintResults(){
	geosparql20results=[];
	reslabels=[];
	if(window.myLine!=null){
		window.myLine.destroy();
	}
    var json=webserviceresult["sparql"]
    var i=1;
    var table="<thead><tr><th>Benchmarks</th><th>Dataset</th><th>Category</th><th>POSTGIS (ms)</th><th>GeoSPARQL2.0 (ms)</th><th>Resultset Size</th></tr></thead><tbody>"
    for(cat in json){
    	table+="<tr style=\"background-color:gray\"><td>"+cat+"</td><td>Total</td><td>"+cat+"</td><td></td><td>"+json[cat]["cattotal"]+"</td><td>"+json[cat]["catobjtotal"]+"</td></tr>"
    	reslabels.push(cat);
    	if(!document.getElementById('nocategories').checked){
    		geosparql20results.push(json[cat]["cattotal"]);
    	}
    	for(obj in json[cat]["array"]){
    		var category="",experiment="";
    		if(json[cat]["array"][obj]["experiment"].includes("_")){
    			var spl=json[cat]["array"][obj]["experiment"].split("_");
        		if(!document.getElementById('onlycategories').checked){
    				reslabels.push(spl[0]+"_"+spl[2])
        		}
    			experiment=spl[0]+"_"+spl[2]
    			category=spl[1];
    		}else{
        		if(!document.getElementById('onlycategories').checked){
    				reslabels.push(json[cat]["array"][obj]["experiment"]); 
        		}
        		experiment=json[cat]["array"][obj]["experiment"]
    		}
    		if(!document.getElementById('onlycategories').checked){
    			geosparql20results.push(json[cat]["array"][obj]["result"]);
    		}
    		table+="<tr><td>"+experiment+"</td><td>"+("dataset" in json[cat]["array"][obj]?json[cat]["array"][obj]["dataset"]:"")+"</td><td>"+cat+"</td><td>"+((obj in postgis)?postgis[obj]["result"]:"")+"</td><td>"+json[cat]["array"][obj]["result"]+"</td><td>"+json[cat]["array"][obj]["resultsize"]+"</td></tr>"
    	}
    }
    $('#queryres').html(table+"</tbody>")
    $("#queryres").tablesorter();
    var config = {
    		type: 'line',
    		data: {
    			labels: reslabels,
    			datasets: [{
    				label: 'GeoSPARQL 2.0',
    				backgroundColor: window.chartColors.red,
    				borderColor: window.chartColors.red,
    				data: geosparql20results,
    				fill: false,
    			}, {
    				label: 'POSTGIS',
    				fill: false,
    				backgroundColor: window.chartColors.blue,
    				borderColor: window.chartColors.blue,
    				data: postgisresults,
    			}]
    		},
    		options: {
    			responsive: true,
    			title: {
    				display: true,
    				text: 'GeoSPARQL 2.0 Benchmark Results'
    			},
    			tooltips: {
    				mode: 'index',
    				intersect: false,
    			},
    			hover: {
    				mode: 'nearest',
    				intersect: true
    			},
    			scales: {
    				xAxes: [{
    					display: true,
    					scaleLabel: {
    						display: true,
    						labelString: 'Experiment'
    					}
    				}],
    				yAxes: [{
    					display: true,
    					scaleLabel: {
    						display: true,
    						labelString: 'Time (ms)'
    					}
    				}]
    			}
    		}
    	};
    var ctx = document.getElementById('myChart').getContext('2d');
    window.myLine = new Chart(ctx, config);
	
}
	function downloadImage(){
		var can = document.getElementsByTagName("canvas");
		var img = can[0].toDataURL("image/png");
		myWindow=window.open('','','width=800,height=800')
		myWindow.document.write('<img src="'+img+'"/>');
		myWindow.focus()

	}
</script>
  <style>
.table-wrapper-scroll-y {
  display: block;
  max-height: 500px;
  max-width: 100%;
  overflow-y: auto;
  -ms-overflow-style: -ms-autohiding-scrollbar;
}
</style>
<body>
<header>
<div class="page-header">
<h1 align="center">GeoSPARQL 2.0 Benchmark</h1>
</div>
</header>
<div class="container" role="main">
  <div class="row">
  <div class="col-sm-9">
  <div id="graphContainer">
  <canvas id="myChart" width="400" height="400"></canvas></div><br/>
<select id="dataset">
<option value="linkedgeodata.ttl" selected="selected">Geographica LinkedGeoData Set</option>
<option value="rasterexample.ttl">Example Raster Data Set</option>
<option value="all">All</option>
<!--<option value="testdata.ttl">Rheinland Pfalz Testset</option>
<option value="testdata3.ttl">Brandenburg TestSet</option>
<option value="testdata4.ttl">Hospital TestSet</option>-->
</select>
<input type="checkbox" name="onlycategories" id="onlycategories" value="cats" onClick="paintResults()">Show only categories
<br/><input type="checkbox" name="nocategories" id="nocategories" value="nocats" onClick="paintResults()">No categories<button id="downloadImageButton" onclick="downloadImage()">Download Image</button><br/>
<select id="benchmarktest">
<option value="all" selected="selected">All</option>
<option value="raster_accessor">Raster Accessor</option>
<option value="raster_algebra">Raster Algebra</option>
<option value="raster_creation">Raster Creation</option>
<option value="raster_export">Raster Export</option>
<option value="raster_modification">Raster Modification</option>
<option value="raster_relation">Raster Relation</option>
<option value="raster_vectorrelation">Raster/Vector Relation</option>
<option value="vector_accessor">Vector Accessor</option>
<option value="vector_creation">Vector Creation</option>
<option value="vector_exporter">Vector Exporter</option>
<option value="vector_modification">Vector Modification</option>
<option value="vector_relation">Vector Relation</option>
</select><br/>
<button onclick="loadAllBenchmarks()">Load All Benchmarks</button><br/>
Benchmark Result:
<div class="col-sm-12" id="queryresult" class="table-wrapper-scroll-y">
<table align="center" id="queryres" class="tablesorter" border="1" width="100%">
</table>
</div>
</div></div></div>
</body>
</html>
